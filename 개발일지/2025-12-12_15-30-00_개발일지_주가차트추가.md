# 개발일지: 화제 종목 주가 차트 추가

## 작성시각
2025년 12월 12일 (금) 15:30

---

## 해결하고자 한 문제

대시보드의 화제 종목 카드에 주가 차트를 추가하여, 주식 초보 사용자가 종목의 최근 가격 흐름을 시각적으로 파악할 수 있도록 개선

### 배경 (ASK 모드 논의 내용)

1. **차트 유형 선택**: 지수 차트(NASDAQ, S&P500, DOW) vs 화제 종목 차트
   - 결론: **화제 종목 차트가 더 유용**
   - 이유: 서비스 핵심 가치("화제 종목 정보 제공")와 직접 연결, 초보자에게 실질적 도움

2. **데이터 소스 검토**
   - yahooquery Screener: 현재 시점 데이터만 제공 → 차트 데이터 불가
   - 해결책: Screener로 종목 심볼 추출 → **Ticker.history()로 차트 데이터 조회**

3. **차트 기간 옵션**
   - 5일 (기본), 1개월, 3개월
   - 장중 차트는 제외 (아침에 보는 서비스라 한국 시간 기준 미국 시장 마감 후)
   - 상세 차트(15분봉)는 제외 (초보자에게 복잡)

4. **기간별 한줄 해설 (규칙 기반)**
   - AI 해설의 장단점 검토
   - 결론: 차트 해설은 규칙 기반으로 자동 생성 (비용 절약, 환각 위험 없음)

5. **데이터 로딩 전략**
   - 기본: 5일 차트만 로드
   - 탭 클릭 시 해당 기간 데이터 로드 + 캐싱
   - 캐싱(Caching): 자주 쓰는 데이터를 임시 저장해두고 재사용하는 것

---

## 해결된 것

### 1. recharts 라이브러리 설치
```bash
npm install recharts
```

### 2. 목업 차트 데이터 추가 (`mockData.ts`)
- `ChartDataPoint` 타입 정의 (date, close, volume)
- `ChartPeriod` 타입 정의 ('5d' | '1mo' | '3mo')
- 종목별 5일/1개월/3개월 차트 데이터 생성 함수
- `generateChartInsight()` 함수: 규칙 기반 차트 해설 생성

### 3. StockChart 컴포넌트 생성 (`StockChart.tsx`)
- **기간 선택 탭**: 5일, 1개월, 3개월 (탭 클릭 시 캐싱)
- **라인 차트**: 종가 기반, 상승/하락 색상 구분 (녹색/빨간색)
- **거래량 바 차트**: 하단에 배치
- **기준선**: 시작가를 점선으로 표시
- **툴팁**: 날짜, 가격, 거래량 표시
- **한줄 해설**: 기간별 변동률 기반 규칙 해설

### 4. StockCard 컴포넌트에 차트 통합
- 위치: 지표 섹션과 초보자 해설 섹션 사이
- `isPositive` prop을 통해 상승/하락 색상 연동

---

## 해결되지 않은 것

1. **실제 API 연동**: 현재 목업 데이터 사용 중
   - 향후 yahooquery Ticker.history() 연동 필요

2. **AI 종합 해설**: 뉴스 + 차트 + 종목 정보 기반 해설
   - 규칙 기반 해설은 구현 완료
   - AI 해설은 추후 검토 (투자 조언 오해 리스크 관리 필요)

---

## 향후 개발을 위한 컨텍스트

### 기술적 결정사항

1. **차트 라이브러리**: recharts 선택
   - React 친화적, 가볍고 커스터마이징 용이

2. **캐싱 전략**: 컴포넌트 내 상태로 관리
   - `loadedPeriods` Set으로 로드된 기간 추적
   - 한 번 로드된 기간은 탭 전환해도 유지

3. **규칙 기반 해설 로직**:
   ```
   +15% 이상: "급등! 매우 강한 상승세" 🔥/🚀
   +5% ~ +15%: "상승했어요. 긍정적인 흐름" 📈
   +1% ~ +5%: "소폭 상승. 안정적" 📊
   -1% ~ +1%: "횡보 중. 방향을 지켜보세요" ➡️
   -5% ~ -1%: "하락했어요. 조정 구간" 📉 (반등 시 🔄)
   -5% 미만: "급락! 신중한 접근 필요" ⚠️ (반등 시 💪)
   ```

4. **색상 체계**:
   - 상승: `#22c55e` (stock-up)
   - 하락: `#ef4444` (stock-down)

### 실제 API 연동 시 참고사항

```python
from yahooquery import Ticker

# 화제 종목 심볼 리스트 (Screener에서 추출)
symbols = ['NVDA', 'TSLA', 'AAPL', 'AMD', 'MSFT']

# 차트 데이터 조회
tickers = Ticker(symbols)
chart_5d = tickers.history(period='5d', interval='1d')
chart_1mo = tickers.history(period='1mo', interval='1d')
chart_3mo = tickers.history(period='3mo', interval='1d')
```

### AI 해설 관련 주의사항 (추후 구현 시)

1. **법적 리스크**: "매수하세요", "오를 것 같아요" 등 투자 권유 표현 금지
2. **환각(Hallucination) 방지**: 팩트 체크 로직 + 출처 명시
3. **면책 문구**: 항상 "AI 해설은 참고용이며, 투자 권유가 아닙니다" 명시
4. **비용**: GPT-4o-mini 기준 하루 5종목 ≈ $0.001 (월 ~$0.03)

---

## 파일 변경 목록

| 파일 | 변경 내용 |
|------|----------|
| `goodmorning/package.json` | recharts 의존성 추가 |
| `goodmorning/src/lib/mockData.ts` | 차트 데이터 타입 및 목업 데이터, 해설 생성 함수 추가 |
| `goodmorning/src/components/StockChart.tsx` | 새로 생성 - 주가 차트 컴포넌트 (Hydration 에러 수정 포함) |
| `goodmorning/src/components/StockCard.tsx` | StockChart 컴포넌트 import 및 통합 |

---

## 추가 기능: 다크/라이트 모드 전환

### 요구사항
1. 헤더에 토글 스위치 배치
2. 아이콘: 🌙 (다크) / ☀️ (라이트)
3. 시스템 설정 감지 (prefers-color-scheme)
4. 로컬스토리지에 선택값 저장
5. 전환 시 부드러운 애니메이션

### 구현 내용

#### 1. ThemeContext 생성 (`contexts/ThemeContext.tsx`)
- `ThemeProvider`: 테마 상태 관리
- `useTheme` 훅: 테마 접근 및 변경
- 시스템 설정 감지 (`prefers-color-scheme`)
- localStorage 저장/불러오기
- Hydration 에러 방지 처리

#### 2. ThemeToggle 컴포넌트 (`components/ThemeToggle.tsx`)
- 토글 스위치 UI
- 🌙 / ☀️ 아이콘 애니메이션
- 부드러운 슬라이드 전환

#### 3. Header/Footer 컴포넌트 분리
- `components/Header.tsx`: 테마 토글 포함
- `components/Footer.tsx`: 테마 대응
- `components/Providers.tsx`: ThemeProvider 래핑

#### 4. 테마 대응 스타일
- `tailwind.config.ts`: `darkMode: 'class'`, 라이트 테마 색상 추가
- `globals.css`: 테마별 배경색, 스크롤바, 그라디언트
- 모든 컴포넌트: `useTheme` 훅 사용하여 동적 스타일 적용

### 추가된 파일
| 파일 | 설명 |
|------|------|
| `goodmorning/src/contexts/ThemeContext.tsx` | 테마 상태 관리 Context |
| `goodmorning/src/components/ThemeToggle.tsx` | 테마 전환 토글 버튼 |
| `goodmorning/src/components/Header.tsx` | 헤더 컴포넌트 (토글 포함) |
| `goodmorning/src/components/Footer.tsx` | 푸터 컴포넌트 |
| `goodmorning/src/components/Providers.tsx` | Provider 래퍼 |

### 수정된 파일
| 파일 | 변경 내용 |
|------|----------|
| `goodmorning/tailwind.config.ts` | darkMode: 'class', 라이트 테마 색상 추가 |
| `goodmorning/src/app/globals.css` | 테마별 스타일 (배경, 스크롤바, 그라디언트) |
| `goodmorning/src/app/layout.tsx` | ThemeProvider 래핑, Header/Footer 컴포넌트 사용 |
| `goodmorning/src/app/page.tsx` | 테마 대응 스타일 |
| `goodmorning/src/components/StockCard.tsx` | 테마 대응 스타일 |
| `goodmorning/src/components/StockChart.tsx` | 테마 대응 스타일 |
| `goodmorning/src/components/MarketOverview.tsx` | 테마 대응 스타일 |
| `goodmorning/src/components/BriefingHistoryCard.tsx` | 테마 대응 스타일 |
| `goodmorning/src/components/GenerateBriefingButton.tsx` | 테마 대응 스타일 |

---

**작성자**: AI Assistant  
**버전**: 1.4 (다크/라이트 모드 전환 기능 추가)

